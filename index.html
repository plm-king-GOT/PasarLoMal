<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>Pasar‚ÄØLo‚ÄØMal</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <meta name="theme-color" content="#0c0c0f" />
  <style>
    /* ============ THEME VARS ============ */
    :root{
      --bg:#0b0b0e;--surface:#191923cc;--border:#32323d;--primary:#e000c8;--primary-dark:#b3009c;--danger:#ff3043;--info:#00e4ff;
      --card-w:64px;--card-h:90px;--blur:24px;--noise:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAIAAAUAAarVyFEAAAAASUVORK5CYII=');
    }

    /* ============ RESET & BASE ============ */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:'Inter',system-ui,sans-serif;background:var(--bg) var(--noise) repeat;color:#f4f4f7;-webkit-tap-highlight-color:transparent}
    h1{font-size:1.75rem;font-weight:700;text-align:center;color:#fff;margin:12px 0 24px}
    h3{font-size:1.05rem;font-weight:600;color:#fff;margin-bottom:8px}
    .container{max-width:960px;margin:auto;padding:24px}

    /* ============ PANELS & GLASS ============ */
    .panel{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:22px 20px;margin-bottom:22px;backdrop-filter:blur(var(--blur));box-shadow:0 6px 22px rgba(0,0,0,.65)}

    /* ============ BUTTONS ============ */
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.4rem;padding:10px 16px;margin:6px 0;border-radius:12px;border:1px solid var(--primary-dark);background:var(--primary);color:#fff;font-size:.95rem;font-weight:600;text-decoration:none;transition:.2s;white-space:nowrap;cursor:pointer}
    .btn:hover{background:var(--primary-dark)}.btn:active{transform:scale(.97)}
    .btn.wide{width:100%}
    .btn.secondary{background:transparent;color:var(--primary);border-color:var(--primary)}.btn.secondary:hover{background:rgba(224,0,200,.12)}
    .btn.small{padding:8px 12px;font-size:.9rem}
    .btn.small .card{flex:none;width:calc(var(--card-w)*.55);height:calc(var(--card-h)*.55)}
    .btn:disabled{opacity:.45;cursor:not-allowed}

    /* ============ INPUTS & PILLS ============ */
    input[type="number"],input[type="text"]{width:100%;padding:11px 14px;margin:4px 0 10px;border-radius:12px;border:1px solid var(--border);background:#101014;color:#eee;font-size:.95rem}
    input::placeholder{color:#777}
    .pill{display:inline-flex;align-items:center;gap:6px;background:#101014;border:1px solid var(--border);border-radius:999px;padding:6px 10px;margin:3px}
    .pill input{border:none;background:transparent;color:#eee;width:70px;font-size:.9rem}
    .pill button{all:unset;color:#888;font-weight:700;cursor:pointer;font-size:.9rem;line-height:1}

    /* ============ CARDS & RAILS ============ */
    .lines{margin:18px 0}
    .line{display:flex;flex-wrap:nowrap;gap:8px;overflow-x:auto;padding:14px 10px;border:1px solid var(--border);border-radius:16px;background:rgba(255,255,255,.04)}
    .card{flex:0 0 var(--card-w);width:var(--card-w);height:var(--card-h);border-radius:14px;border:1px solid var(--border);background:linear-gradient(135deg,#2d2d32 0%,#1b1b1f 100%);display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:6px;font-weight:600;color:#fafafa;user-select:none;transition:transform .15s,box-shadow .15s}
    .card.red{color:var(--danger)}
    .rank,.suit{font-size:1.05rem}
    .clickable{cursor:pointer;position:relative;overflow:hidden}
    .clickable::after{content:"";position:absolute;inset:0;background:#fff4;opacity:0;transition:opacity .2s}
    .clickable:active::after{opacity:1}
    .current-card{background:#53142e;border-color:#8b1c48}

    /* ============ BANNERS & LOG ============ */
    .banner{padding:13px 15px;border-radius:14px;text-align:center;font-weight:600;font-size:.92rem}
    .banner.success{background:#14532d;color:#c8facc}.banner.fail{background:#7f1d1d;color:#fca5a5}.banner.equal{background:#3c3301;color:#f8e86a}
    #gameLog{max-height:200px;overflow-y:auto;background:#101014;border:1px solid var(--border);border-radius:16px;padding:14px}
    .log-entry{margin:3px 0;font-size:.84rem;opacity:.85}

    /* ============ RESPONSIVE ============ */
    @media(max-width:380px){html{font-size:14px}}
    @media(max-width:600px){:root{--card-w:52px;--card-h:74px}}
  </style>
</head>
<body>
  <div class="container">
    <h1>üïπÔ∏è Pasar¬†Lo¬†Mal</h1>

    <!-- SETUP -->
    <section id="setupPhase" class="panel">
      <h3>Configuration</h3>
      <label>Nombre de joueurs<br><input type="number" id="nbPlayers" min="2" max="8" value="2"></label>
      <button class="btn wide" onclick="prepareNamePills()">Suivant ‚ûú</button>
      <div id="namesSection" style="display:none;margin-top:12px">
        <h3>Pseudos</h3>
        <div id="pillsWrap" style="display:flex;flex-wrap:wrap"></div>
        <button class="btn wide" onclick="startGame()">Lancer le jeu üöÄ</button>
      </div>
    </section>

    <!-- GAME -->
    <section id="gamePhase" style="display:none">
      <div class="panel" id="status"></div>
      <p id="instruction" style="text-align:center;font-weight:500">S√©lectionnez une extr√©mit√©.</p>
      <div class="lines" id="gameLines"></div>

      <div class="panel" style="text-align:center">
        <p style="margin:0 0 8px;font-weight:600">Votre carte</p>
        <span id="drawnCard" class="card current-card">?</span>
      </div>

      <!-- Pari -->
      <div id="guessPhase" class="panel" style="display:none;text-align:center">
        <p style="margin-bottom:12px;font-weight:500">Votre carte sera‚Ä¶</p>
        <button class="btn small wide" onclick="makeGuess('<')">plus¬†PETITE¬†<span id="compareLT" class="card"></span></button>
        <button class="btn small secondary wide" onclick="makeGuess('>')">plus¬†GRANDE¬†<span id="compareGT" class="card"></span></button>
        <button class="btn small secondary wide" style="border-color:var(--c-warning);color:var(--c-warning)" onclick="makeGuess('=')">√âGALE¬†<span id="compareEQ" class="card"></span></button>
      </div>

      <div id="resultBanner" class="banner" style="display:none"></div>
      <button id="nextTurnBtn" class="btn wide" style="display:none">Tour suivant ‚ûú</button>
      <button class="btn wide secondary" onclick="location.reload()">‚Üª¬†Rejouer</button>
    </section>

    <!-- LOG -->
    <section id="gameLog" class="panel" style="display:none"><h3>Historique</h3><div id="logContent"></div></section>
  </div>

<script>
/***** Helpers *****/
const $ = id => document.getElementById(id);
const SUITS=['‚ô†','‚ô•','‚ô£','‚ô¶'], RANKS=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const shuffle = arr => arr.sort(()=>Math.random()-0.5);
const buildDeck = () => shuffle(SUITS.flatMap(s=>RANKS.map(r=>r+s)));
const applyCard = (el,c) => {el.innerHTML=`<span class='rank'>${c.slice(0,-1)}</span><span class='suit'>${c.slice(-1)}</span>`;el.classList.toggle('red',/[‚ô•‚ô¶]$/.test(c));};
const log = txt => {const lg=$('gameLog');lg.style.display='block';$('logContent').insertAdjacentHTML('beforeend',`<div class='log-entry'>${txt}</div>`);lg.scrollTop=lg.scrollHeight;};

/***** Game Logic *****/
class Game{
  constructor(players){this.players=players;this.nb=players.length;this.deck=buildDeck();this.lines=Array.from({length:5},()=>[this.draw()]);this.p=0;this.round=1;this.turn=0;this.current='';}
  draw(){return this.deck.pop();}
  cmp(a,b){return RANKS.indexOf(a.slice(0,-1))-RANKS.indexOf(b.slice(0,-1));}
  play(card,lineIdx,left,op){const L=this.lines[lineIdx],ref=left?L[0]:L[L.length-1];left?L.unshift(card):L.push(card);const d=this.cmp(card,ref);const win=(op=='<'?d<0:op=='>'?d>0:d===0);let pen=0,bonus=0;if(!win){pen=L.length;this.deck.unshift(...L.splice(0));L.push(this.draw());}else if(op==='=')bonus=10;return{win,pen,bonus,ref};}
}

/***** State *****/
let game=null, chosenLine=null, chosenLeft=null;const nextBtn=$('nextTurnBtn');

/***** Setup Flow *****/
function prepareNamePills(){const n=+$('nbPlayers').value;$('setupPhase').querySelector('.btn').disabled=true;const wrap=$('pillsWrap');wrap.innerHTML='';for(let i=0;i<n;i++)wrap.insertAdjacentHTML('beforeend',`<span class="pill"><input value="Joueur ${i+1}"/><button onclick="this.parentElement.remove()">√ó</button></span>`);$('namesSection').style.display='block';}
function collectNames(){return[...document.querySelectorAll('.pill input')].map(i=>i.value.trim()).filter(Boolean);} 
function startGame(){const names=collectNames();if(names.length<2){alert('Au moins deux noms');return;}game=new Game(names);$('setupPhase').style.display='none';$('gamePhase').style.display='block';nextTurn();}

/***** Rendering *****/
function renderStatus(){$('status').innerHTML=`üÉè <strong>${game.players[game.p]}</strong> | Tour ${game.turn+1}/3 | Manche ${game.round} | Pioche ${game.deck.length}`;}
function renderLines(){const zone=$('gameLines');zone.innerHTML='';game.lines.forEach((line,i)=>{const rail=document.createElement('div');rail.className='line';line.forEach((c,idx)=>{const span=document.createElement('span');span.className='card';applyCard(span,c);if(idx==0||idx==line.length-1){span.classList.add('clickable');span.dataset.line=i;span.dataset.left=idx==0;span.onclick=onCardClick;}rail.appendChild(span);});zone.appendChild(rail);});}

/***** Turn Flow *****/
function nextTurn(){if(game.turn>=3){game.turn=0;game.round++;game.p=(game.p+1)%game.nb;}try{game.current=game.draw();}catch{return alert('Plus de cartes');}
  $('drawnCard').textContent='?';$('resultBanner').style.display='none';$('guessPhase').style.display='none';$('instruction').style.display='block';nextBtn.style.display='none';renderStatus();renderLines();}

/***** Interactions *****/
function onCardClick(ev){if($('guessPhase').style.display==='block')return;chosenLine=+ev.currentTarget.dataset.line;chosenLeft=ev.currentTarget.dataset.left==='true';const ref=ev.currentTarget.textContent.trim();['compareLT','compareGT','compareEQ'].forEach(id=>applyCard($(id),ref));$('instruction').style.display='none';$('guessPhase').style.display='block';navigator.vibrate?.(10);} 
function makeGuess(op){const {win,pen,bonus,ref}=game.play(game.current,chosenLine,chosenLeft,op);applyCard($('drawnCard'),game.current);$('guessPhase').style.display='none';const banner=$('resultBanner');banner.className='banner '+(win?(op==='='?'equal':'success'):'fail');banner.textContent = win ? (op==='='?`‚≠ê Jackpot +${bonus}`:'Tu es priv√© de boisson pour ce tour.') : `üíß ${game.players[game.p]}, tu bois ${pen} gorg√©es`;banner.style.display='block';log(`${game.players[game.p]} ‚ûú ${game.current} (${op}) vs ${ref} ‚Äî ${win?'‚úÖ':'‚ùå'}`);game.turn++;nextBtn.style.display='block';nextBtn.onclick=nextTurn;}
</script>
</body>
</html>
