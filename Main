<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pasar‚ÄØLo‚ÄØMal ‚Äì Web</title>
  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root { --c-bg:#f6f8fa;--c-surface:rgba(255,255,255,.85);--c-border:rgba(0,0,0,.08);--c-border-strong:rgba(0,0,0,.16);--c-primary:#10a37f;--c-primary-dark:#0e8d6c;--c-danger:#ff5d5d;--c-warning:#ffb700;--blur:18px;--card-w:64px;--card-h:90px; }
    html,body{margin:0;padding:0;background:var(--c-bg);font-family:"Inter",system-ui,sans-serif;color:#141517;}*{box-sizing:border-box;}
    h1{text-align:center;margin:0 0 1rem;font-weight:700;letter-spacing:-.02em;}h3{margin:0 0 .5rem;font-weight:600;}
    .container{max-width:980px;margin:0 auto;padding:24px;}
    .panel{background:var(--c-surface);backdrop-filter:blur(var(--blur));-webkit-backdrop-filter:blur(var(--blur));border:1px solid var(--c-border);border-radius:20px;padding:24px;box-shadow:0 4px 14px rgba(0,0,0,.05);margin-bottom:24px;}
    .btn{width:100%;display:inline-flex;justify-content:center;align-items:center;gap:.4rem;padding:14px 20px;margin:6px 0;font-size:1rem;font-weight:600;border-radius:12px;border:1px solid var(--c-primary);background:var(--c-primary);color:#fff;cursor:pointer;transition:background .2s,transform .1s;} .btn:hover{background:var(--c-primary-dark);} .btn:active{transform:scale(.97);} .btn.secondary{background:transparent;color:var(--c-primary-dark);border-color:var(--c-primary-dark);} .btn.secondary:hover{background:rgba(16,163,127,.1);} .btn:disabled{background:#d1d5db;border-color:#d1d5db;cursor:not-allowed;}
    input[type="number"],input[type="text"]{width:100%;padding:12px 14px;margin:4px 0 10px;border:1px solid var(--c-border-strong);border-radius:12px;font-size:1rem;background:#fff;}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;background:var(--c-surface);border:1px solid var(--c-border-strong);border-radius:999px;font-weight:500;margin:4px 4px;} .pill input{border:none;background:transparent;width:80px;font:inherit;padding:0;} .pill button{all:unset;cursor:pointer;font-weight:700;}
    .lines{margin:24px 0;} .line{display:flex;flex-wrap:wrap;gap:10px;padding:14px 12px;border-radius:18px;background:var(--c-surface);border:1px solid var(--c-border);backdrop-filter:blur(calc(var(--blur)/1.5));margin:12px 0;min-height:calc(var(--card-h)+14px);} .card{width:var(--card-w);height:var(--card-h);background:linear-gradient(135deg,#fff 0%,#f0f0f3 100%);border-radius:12px;border:1px solid var(--c-border-strong);display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:6px;font-weight:600;color:#141517;box-shadow:0 1px 3px rgba(0,0,0,.08);user-select:none;transition:transform .15s,box-shadow .15s;} .card.red{color:var(--c-danger);} .card .rank,.card .suit{font-size:1.05rem;} .clickable{cursor:pointer;} .clickable:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.1);} .clickable:active{transform:scale(.95);box-shadow:none;} .current-card{background:#ffe791;border-color:#ffcb4d;}
    .banner{text-align:center;font-size:1rem;font-weight:600;padding:18px 20px;border-radius:18px;} .banner.success{background:#d3f8e4;color:#027353;} .banner.fail{background:#ffd2d2;color:#b00020;} .banner.equal{background:#fff6d5;color:#a46c00;}
    #gameLog{max-height:260px;overflow-y:auto;padding:16px;border-radius:20px;background:var(--c-surface);border:1px solid var(--c-border);backdrop-filter:blur(calc(var(--blur)/2));} .log-entry{margin:6px 0;font-size:.9rem;opacity:.9;}
    @media(max-width:600px){:root{--card-w:52px;--card-h:74px;} .panel{padding:20px;}}
  </style>
</head>
<body>
  <div class="container">
    <h1>üÉè Pasar‚ÄØLo‚ÄØMal</h1>
    <!-- SETUP -->
    <section id="setupPhase" class="panel">
      <h3>Pr√©parons la partie</h3>
      <label>Combien de joueurs&nbsp;?<br><input type="number" id="nbPlayers" min="2" max="8" value="2"/></label>
      <button class="btn" onclick="prepareNamePills()">Suivant ‚ûú</button>
      <div id="namesSection" style="display:none;margin-top:16px;">
        <h3>Choisissez vos pseudos</h3>
        <div id="pillsWrap" style="display:flex;flex-wrap:wrap;"></div>
        <button class="btn" onclick="startGame()">Lancer la partie üöÄ</button>
      </div>
    </section>
    <!-- GAME -->
    <section id="gamePhase" style="display:none;">
      <div class="panel" id="statusPanel">
        <div style="display:flex;gap:24px;flex-wrap:wrap;align-items:center;justify-content:space-between;">
          <div><strong>Au tour de</strong><br><span id="currentPlayer"></span></div>
          <div><strong>Tour</strong><br><span id="turnInRound"></span>/3</div>
          <div><strong>Manche</strong><br><span id="currentRound"></span></div>
          <div><strong>Cartes restantes</strong><br><span id="cardsLeft"></span></div>
        </div>
      </div>
      <div class="panel" style="text-align:center;">
        <p style="margin:0 0 12px;font-weight:500;">Votre carte</p><span id="drawnCard" class="card current-card">?</span>
      </div>
      <p id="instruction" style="text-align:center;font-weight:500;">Touchez une extr√©mit√© de ligne pour placer votre carte.</p>
      <div class="lines" id="gameLines"></div>
      <div id="resultBanner" class="banner" style="display:none;"></div>
      <button id="nextTurnBtn" class="btn" style="display:none;">Tour suivant ‚ûú</button>
      <div id="guessPhase" class="panel" style="display:none;text-align:center;">
        <p style="font-weight:500;margin-bottom:16px;">Votre carte sera‚Ä¶</p>
        <div style="display:flex;flex-direction:column;gap:12px;max-width:300px;margin:auto;">
          <button class="btn" onclick="makeGuess('<')">plus PETITE que <span id="compareLT" class="card"></span></button>
          <button class="btn secondary" onclick="makeGuess('>')">plus GRANDE que <span id="compareGT" class="card"></span></button>
          <button class="btn secondary" style="border-color:var(--c-warning);color:var(--c-warning);" onclick="makeGuess('=')">√âGALE √† <span id="compareEQ" class="card"></span></button>
        </div>
      </div>
      <button class="btn secondary" onclick="location.reload()">‚ü≤ Rejouer</button>
    </section>
    <!-- LOG -->
    <section id="gameLog" class="panel" style="display:none;"><h3>Historique</h3><div id="logContent"></div></section>
  </div>
<script>
  const SUITS=['‚ô†','‚ô•','‚ô£','‚ô¶'];const $=id=>document.getElementById(id);
  const cardHTML=c=>{const s=c.slice(-1),r=c.slice(0,-1);return`<span class="rank">${r}</span><span class="suit">${s}</span>`};
  const applyCard=(el,code)=>{el.innerHTML=cardHTML(code);el.classList.toggle('red',/[‚ô•‚ô¶]$/.test(code));};
  const buildDeck=r=>SUITS.flatMap(s=>r.map(k=>k+s));
  /* Game */
  class Game{constructor(n){this.nb=n;this.ranks=['A','2','3','4','5','6','7','8','9','10','J','Q','K'];this.players=[];this.lines={};this.deck=[];this.p=0;this.round=1;this.turn=0;this.currentCard=null;}rankOf=c=>c.slice(0,-1);cmpRank=(a,b)=>this.ranks.indexOf(this.rankOf(a))-this.ranks.indexOf(this.rankOf(b));setup(names){this.players=names;this.deck=buildDeck(this.ranks);for(let i=0;i<5;i++){this.lines[i]=[this.deck.splice(Math.random()*this.deck.length|0,1)[0]];}log(`üéÆ Nouvelle partie ‚Äì ${names.join(', ')}`);}draw(){if(!this.deck.length)throw'fin';return this.deck.splice(Math.random()*this.deck.length|0,1)[0];}play(card,line,left,op){const L=this.lines[line];const ref=left?L[0]:L[L.length-1];left?L.unshift(card):L.push(card);const diff=this.cmpRank(card,ref);let win=false,penalty=0,bonus=0;switch(op){case '<':win=diff<0;break;case '>':win=diff>0;break;case '=':win=diff===0;break;}if(!win){penalty=L.length;this.deck.push(...L.splice(0));L.push(this.draw());}else if(op==='='){bonus=10;}return{win,penalty,bonus,ref};}}
  /* Globals */
  let game,chosenLine=null,chosenLeft=null,compareCode=null;const nextBtn=$('nextTurnBtn');
  function log(t){$('gameLog').style.display='block';const d=document.createElement('div');d.className='log-entry';d.textContent=t;$('logContent').append(d);$('logContent').scrollTop=$('logContent').scrollHeight;}
  /* Setup players pills */
  function prepareNamePills(){const n=+$('nbPlayers').value;$('setupPhase').querySelector('button').disabled=true;const wrap=$('pillsWrap');wrap.innerHTML='';for(let i=0;i<n;i++){const pill=document.createElement('span');pill.className='pill';pill.innerHTML=`<input value="Joueur ${i+1}"/> <button onclick="this.parentElement.remove()">√ó</button>`;wrap.appendChild(pill);}$('namesSection').style.display='block';}
  function collectNames(){return[...document.querySelectorAll('.pill input')].map(i=>i.value.trim()).filter(Boolean);}
  /* Start game */
  function startGame(){const names=collectNames();if(names.length<2){alert('Entrez au moins deux noms');return;}game=new Game(names.length);game.setup(names);$('setupPhase').style.display='none';$('gamePhase').style.display='block';nextTurn();}
  /* Render */
  function render(){$('currentPlayer').textContent=game.players[game.p];$('turnInRound').textContent=game.turn+1;$('currentRound').textContent=game.round;$('cardsLeft').textContent=game.deck.length;const zone=$('gameLines');zone.innerHTML='';for(let i=0;i<5;i++){const row=document.createElement('div');row.className='line';game.lines[i].forEach((card,idx)=>{const c=document.createElement('span');c.className='card';applyCard(c,card);if(idx===0||idx===game.lines[i].length-1){c.classList.add('clickable');c.dataset.line=i;c.dataset.left=idx===0;c.onclick=onCardClick;}row.appendChild(c);});zone.appendChild(row);}}
  /* Flow */
  function nextTurn(){if(game.turn>=3){game.turn=0;game.round=game.round%3+1;game.p=(game.p+1)%game.nb;}try{game.currentCard=game.draw();}catch{alert('Plus de cartes');return;}$('drawnCard').textContent='?';$('drawnCard').classList.remove('red');$('instruction').style.display='block';$('guessPhase').style.display='none';$('resultBanner').style.display='none';nextBtn.style.display='none';chosenLine=chosenLeft=compareCode=null;render();}
  /* Interactions */
  function onCardClick(e){if($('guessPhase').style.display==='block')return;chosenLine=+e.currentTarget.dataset.line;chosenLeft=e.currentTarget.dataset.left==='true';compareCode=e.currentTarget.textContent.trim();['compareLT','compareGT','compareEQ'].forEach(id=>applyCard($(id),compareCode));$('instruction').style.display='none';$('guessPhase').style.display='block';}
  function makeGuess(op){if(chosenLine===null)return;const {win,penalty,bonus,ref}=game.play(game.currentCard,chosenLine,chosenLeft,op);applyCard($('drawnCard'),game.currentCard);$('guessPhase').style.display='none';let verdict='',cls='';if(win){if(op==='='){verdict=`‚≠ê Jackpot¬†! Distribuez ${bonus} gorg√©es.`;cls='equal';}else{verdict='üéâ Bien jou√©¬†!';cls='success';}}else{verdict=`üíß ${penalty} gorg√©es pour vous.`;cls='fail';}$('resultBanner').innerHTML=`<strong>${game.players[game.p]}</strong> visait ${op==='<'?'plus petit':op==='>'?'plus grand':'√©gal'} √† ${ref}<br>Vous tirez ${game.currentCard}.<br><span style="font-size:1.1rem;">${verdict}</span>`;$('resultBanner').className='banner '+cls;$('resultBanner').style.display='block';log(`${game.players[game.p]} ‚Üí ${game.currentCard} (${op}) vs ${ref} ‚Äì ${win?'OK':'KO'}${win&&bonus?` (+${bonus})`:!win?` (-${penalty})`:''}`);game.turn++;
    /* Activer bouton "tour suivant" */
    nextBtn.style.display='block';
    nextBtn.onclick=()=>{ nextBtn.style.display='none'; nextTurn(); };
  }
</script>
</body>
</html>
